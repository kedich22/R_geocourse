---
title: "Class11-2"
author: "Andrei Kedich"
date: "17 11 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Одна из гипотез, часто используемых в геомаркетинге — это так называемые аттракторы потоков — пространственные объекты, которые сосредотачивают в своей близости высокую плотность пешеходного трафика. Типичный пример аттрактора — любая транспортная локация: выход из метро, железнодорожная платформа, автобусная остановка. Владельцы предприятий сферы услуг в теории стремятся размещать свои точки вблизи к аттракторам. Используя данные из настоящей лекции, проведите проверку реалистичности этой теории. Для этого:

постройте вокруг выходов станций метро несколько буферных зон увеличивающегося радиуса
выберите ими пункты общественного питания
рассчитайте их плотность как отношение количества к площади буфера
Далее постройте график зависимости между радиусом буфера и плотностью объектов интереса. Рассчитайте также коэффициент корреляции между этими величинами

Подключение библиотек и загрузка данных


```{r}
library(sf)
library(tidyverse)
library(units)
poi = st_read("poi_point.gpkg")
stations = st_read("metro_stations.gpkg")
```

Фильтрация
```{r}
poi.food = poi %>% 
            dplyr::select(NAME, AMENITY) %>% 
            filter(AMENITY %in% c("restaurant", "bar", "cafe", "pub", "fast_food"))
```


Анализ
```{r}
distances = seq(50, 300, 50)

stats = sapply(distances, function (d) {
  buf = st_buffer(stations, dist = d) %>% 
    st_union()
  npoi = nrow(poi.food[buf, ])
  return(npoi / units::set_units(st_area(buf), km^2))
})

qplot(distances, stats, geom = 'line')
```

